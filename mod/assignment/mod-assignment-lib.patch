    function delete_instance($assignment) {
        global $CFG, $DB;

        $assignment->courseid = $assignment->course;

        $result = true;

        // LIGHTWORK PATCH STARTS
        //1.delete lw_marking_history, lw_marking , lw_rubric 
        // team, and team_student records referencing this assignment 
        //2.delete rubric files from file dir
        if (! $DB->delete_records('lw_marking_history', array('activity'=>$assignment->id))) {
            $result = false;
        }

        if (! $DB->delete_records('lw_marking', array('activity'=>$assignment->id))) {
            $result = false;
        }
        
        if (! $DB->delete_records('lw_team_marking_history', array('activity'=>$assignment->id))) {
            $result = false;
        }

        if (! $DB->delete_records('lw_team_marking', array('activity'=>$assignment->id))) {
            $result = false;
        }
        
        if (! $DB->delete_records('lw_feedback', array('activity'=>$assignment->id))) {
            $result = false;
        }

        if (! $DB->delete_records('lw_rubric', array('activity'=>$assignment->id))) {
            $result = false;
        }

        //check assignment type
        $assignmenttype = $assignment -> assignmenttype;
        if ($assignmenttype == 'team') {
            $teams = $DB->get_records_sql("SELECT id, assignment, name, membershipopen".
                                 " FROM {team} ".
                                 " WHERE assignment = ".$assignment->id);
            if ($teams) {
                //delete all team_student in these teams
                foreach ($teams as $team) {
                    if (! $DB->delete_records('team_student', array('team'=>$team->id))) {
                        $result = false;
                    }
                }
                //delete all teams
                if (! $DB->delete_records('team', array('assignment'=>$assignment->id))) {
                    $result = false;
                }
            }            
        }
        if ($assignmenttype == 'feedback') {
            $submissions = $DB->get_records_sql("SELECT id FROM {assignment_submissions}".
                                           " WHERE assignment = ".$assignment->id);
            foreach ($submissions as $submission){
                if (!$DB->delete_records('feedback_submission', array('submission'=>$submission->id))) {
                    $result = false;
                }
            }        
        }
        require_once($CFG->libdir.'/filelib.php');
        require_once($CFG->dirroot.'/local/lightwork/lib/lw_document.php');
        fulldelete($CFG->dataroot.'/'.$assignment->course.'/'.LW_document::LW_FOLDER_NAME.'/assignment/'.$assignment->id);
        // LIGHTWORK PATCH ENDS
        
        // now get rid of all files
        $fs = get_file_storage();
        if ($cm = get_coursemodule_from_instance('assignment', $assignment->id)) {
            $context = get_context_instance(CONTEXT_MODULE, $cm->id);
            $fs->delete_area_files($context->id);
        }

        if (! $DB->delete_records('assignment_submissions', array('assignment'=>$assignment->id))) {
            $result = false;
        }

        if (! $DB->delete_records('event', array('modulename'=>'assignment', 'instance'=>$assignment->id))) {
            $result = false;
        }

        if (! $DB->delete_records('assignment', array('id'=>$assignment->id))) {
            $result = false;
        }
        $mod = $DB->get_field('modules','id',array('name'=>'assignment'));

        assignment_grade_item_delete($assignment);

        return $result;
    }