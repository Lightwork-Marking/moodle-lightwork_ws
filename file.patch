/**
The reason for this patch file:
If a marker uploads the rubric PDF to Moodle from Lightwork, students can view the PDF file in Moodle. 
However, /moodle/file.php has a mechanism to cache the old PDF file in the browser. 
If the PDF file is modified again in Lightwork and uploaded to Moodle, students will still see 
the old PDF file because of this caching mechanism. 
We fixed this issue by setting its $lifetime = 0 in /moodle/file.php.
*/

    // ========================================
    // finally send the file
    // ========================================
    session_write_close(); // unlock session during fileserving
    $filename = $args[count($args)-1];
    
    //++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    //Lightwork patch start
    require_once($CFG->dirroot.'/local/lightwork/lib/lw_document.php');
    if ((count($args) >= 3)
        and (strtolower($args[1]) == Lw_document::LW_FOLDER_NAME)
        and (strtolower($args[2]) == 'assignment')) {
            $lifetime = 0; //Prevent browser from caching Lightwork files
    }
    //Lightwork patch end    
    //++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    
    send_file($pathname, $filename, $lifetime, $CFG->filteruploadedfiles, false, $forcedownload);
